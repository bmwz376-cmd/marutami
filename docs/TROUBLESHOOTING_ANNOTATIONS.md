# 🔧 注釈機能・重要ポイントが動作しない問題の解決方法

## 📋 問題の確認

以下の機能が動作しない：
1. **注釈ツール**（ピン、レーザーポインタ、丸、四角、ペン）
2. **重要ポイントカード**

---

## 🛠️ 解決方法（ステップバイステップ）

### ステップ1: ブラウザのコンソールを開く

#### Google Chromeの場合
1. 講師画面を開いている状態で `F12` キーを押す
2. または右クリック → 「検証」→ 「Console」タブをクリック

#### その他のブラウザ
- Firefox: `F12`
- Edge: `F12`
- Safari: `Command + Option + C` (Mac)

### ステップ2: エラーメッセージを確認

コンソールに赤いエラーメッセージが表示されている場合：

#### よくあるエラー1: `instructor is not defined`
**原因**: JavaScript ファイルが読み込まれていない

**解決方法**:
```
ブラウザをハードリロード（強制再読み込み）:
- Windows/Linux: Ctrl + Shift + R
- Mac: Command + Shift + R
```

#### よくあるエラー2: `sync is not defined`
**原因**: sync.js が読み込まれていない

**解決方法**: 同上（ハードリロード）

#### よくあるエラー3: `Cannot read property 'addEventListener' of null`
**原因**: HTML要素が見つからない

**解決方法**: ページを完全リロード

---

### ステップ3: 手動テスト

コンソールに以下を1行ずつ入力して、エラーが出るか確認：

```javascript
// テスト1: instructor オブジェクトの確認
console.log(instructor);

// テスト2: 注釈モード設定のテスト
instructor.setAnnotationMode('pin');

// テスト3: 重要ポイント表示のテスト
instructor.showImportantCard('テスト', ['項目1', '項目2']);
```

**期待される結果**:
- テスト1: `InstructorController {roomId: "...", ...}` が表示される
- テスト2: コンソールに `注釈モード: pin` が表示される
- テスト3: モーダルが表示される

---

### ステップ4: タブが表示されているか確認

1. 右パネルの上部に4つのタブが表示されているか確認：
   - 制御
   - 注釈
   - ノート
   - 重要ポイント

2. 「注釈」タブをクリック
3. ボタンが5つ表示されているか確認：
   - 📍 ピン
   - ⭕ 丸
   - ▭ 四角
   - ✏️ ペン
   - 🔴 レーザーポインタ

---

### ステップ5: 注釈ツールの使い方（正しい手順）

#### ピンの使い方
1. 右パネル「注釈」タブを開く
2. **「📍 ピン」ボタンをクリック**（ボタンが青くハイライトされる）
3. **中央のページ画像をクリック**
4. 赤いピンが表示される

⚠️ **よくある間違い**:
- ピンボタンを押さずに、いきなり画像をクリックしている
- ピンボタンを押した後、もう一度ボタンをクリックしている（画像をクリックしてください）

#### レーザーポインタの使い方
1. 右パネル「注釈」タブを開く
2. **「🔴 レーザーポインタ」ボタンをクリック**
3. **中央のページ画像をクリック**
4. 黄色い光点が表示され、3秒後に自動で消える

#### 重要ポイントカードの使い方
1. 右パネル「重要ポイント」タブを開く
2. カードボタンをクリック（例：「配筋検査の要点」）
3. 画面中央にモーダル（大きなカード）が表示される
4. 「次へ」ボタンでモーダルを閉じる

---

## 🐛 デバッグ用：改善版ファイル

もし上記で解決しない場合、デバッグログを追加したバージョンを使用します。

### 改善版 instructor.js（デバッグ付き）

講師画面のコンソールに詳細なログが表示されるようになります：
- ボタンクリック時のログ
- 注釈追加時のログ
- WebSocket送信時のログ

---

## 📞 具体的な症状別の対処法

### 症状1: 「注釈」タブをクリックしても何も起きない

**原因**: タブ切り替えのJavaScriptが動作していない

**解決方法**:
1. `F12` でコンソールを開く
2. 以下を入力：
```javascript
document.querySelectorAll('.tab-btn').forEach(btn => {
    console.log(btn.dataset.tab, btn);
});
```
3. 4つのタブが表示されれば、HTML は正常
4. ブラウザをハードリロード（Ctrl + Shift + R）

---

### 症状2: 「📍 ピン」ボタンをクリックしても画像をクリックできない

**原因**: 
- A. ボタンが押されていない（青くハイライトされていない）
- B. クリックイベントが登録されていない

**解決方法**:
1. ピンボタンをクリック後、ボタンが**青くハイライト**されるか確認
2. コンソールに `注釈モード: pin` と表示されるか確認
3. 表示されない場合、以下を実行：
```javascript
instructor.setAnnotationMode('pin');
```
4. 画像をクリックして、コンソールにエラーが出ないか確認

---

### 症状3: 重要ポイントカードボタンをクリックしても何も起きない

**原因**: 
- A. モーダル要素が存在しない
- B. onclick 属性が動作していない

**解決方法**:
1. コンソールで以下を実行：
```javascript
instructor.showImportantCard('テスト', ['項目1', '項目2', '項目3']);
```
2. モーダルが表示されれば、JavaScript は正常
3. 表示されない場合、以下を確認：
```javascript
document.getElementById('important-modal');
```
4. `null` が返る場合、HTML要素が存在しない → ページリロード

---

### 症状4: すべてのボタンが反応しない

**原因**: JavaScript ファイル全体が読み込まれていない

**解決方法**:
1. コンソールで以下を確認：
```javascript
typeof instructor
```
2. `"undefined"` が返る場合、instructor.js が読み込まれていない
3. ブラウザのネットワークタブで `instructor.js` のステータスを確認
4. 404エラーの場合、ファイルが存在しない → Flaskアプリ再起動

---

## 🔍 最終確認チェックリスト

注釈機能を使う前に、以下を確認してください：

- [ ] Flaskアプリが起動している
- [ ] 講師画面URLにアクセスしている（`/instructor/...`）
- [ ] ページが正常に表示されている
- [ ] 右パネルに4つのタブが表示されている
- [ ] ブラウザのコンソールにエラーが出ていない
- [ ] `instructor` オブジェクトがコンソールで確認できる

---

## 💡 すぐに試せる簡単なテスト

### テスト1: 重要ポイントカードの表示
1. 講師画面を開く
2. `F12` でコンソールを開く
3. 以下をコピー＆ペースト：
```javascript
instructor.showImportantCard('動作テスト', ['テスト項目1', 'テスト項目2', 'テスト項目3']);
```
4. Enterキーを押す
5. **モーダル（カード）が表示されるはず**

### テスト2: ピンの追加
1. 講師画面を開く
2. `F12` でコンソールを開く
3. 以下をコピー＆ペースト：
```javascript
instructor.setAnnotationMode('pin');
```
4. Enterキーを押す
5. コンソールに `注釈モード: pin` と表示される
6. **中央の画像をクリック**
7. **赤いピンが表示されるはず**

---

## 🆘 それでも動作しない場合

以下の情報を教えてください：

1. **ブラウザの種類とバージョン**
   - 例: Google Chrome 120.0.6099.129

2. **コンソールのエラーメッセージ**（全文）
   - `F12` → Console タブのエラーをコピー

3. **以下のコマンドの実行結果**:
```javascript
console.log('instructor:', typeof instructor);
console.log('sync:', typeof sync);
console.log('viewer:', typeof viewer);
console.log('modal:', document.getElementById('important-modal'));
```

4. **実行した操作**
   - 例: 「注釈タブを開いて、ピンボタンを押して、画像をクリックしたが何も起きない」

---

## 📝 まとめ

### 正しい使い方（注釈ツール）
1. 右パネル「注釈」タブを開く
2. 使いたいツールのボタンをクリック（例：📍 ピン）
3. ボタンが青くハイライトされることを確認
4. 中央のページ画像をクリック
5. 注釈が表示される

### 正しい使い方（重要ポイント）
1. 右パネル「重要ポイント」タブを開く
2. カードボタンをクリック（例：「配筋検査の要点」）
3. モーダルが表示される
4. 「次へ」ボタンで閉じる

---

**この手順で解決しない場合は、詳しい状況を教えてください！** 😊
